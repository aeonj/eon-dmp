Ext.apply(Function.prototype,{createInterceptor:function(i,n){var a=this;return Ext.isFunction(i)?function(){var e=this,t=arguments;return i.target=e,i.method=a,!1!==i.apply(n||e||window,t)?a.apply(e||window,t):null}:this},createCallback:function(){var e=arguments,t=this;return function(){return t.apply(window,e)}},createDelegate:function(i,n,a){var s=this;return function(){var e,t=n||arguments;return!0===a?t=(t=Array.prototype.slice.call(arguments,0)).concat(n):Ext.isNumber(a)&&(t=Array.prototype.slice.call(arguments,0),e=[a,0].concat(n),Array.prototype.splice.apply(t,e)),s.apply(i||window,t)}},defer:function(e,t,i,n){var a=this.createDelegate(t,i,n);return 0<e?setTimeout(a,e):(a(),0)}}),Ext.override(Ext.tree.Column,{cellTpl:['<tpl for="lines">','<div class="{parent.childCls} {parent.elbowCls}-img ','{parent.elbowCls}-<tpl if=".">line<tpl else>empty</tpl>" role="presentation"></div>',"</tpl>",'<div class="{childCls} {elbowCls}-img {elbowCls}','<tpl if="isLast">-end</tpl><tpl if="expandable">-plus {expanderCls}</tpl>" role="presentation"></div>','<tpl if="checked !== null">','<div role="button" <tpl if="checked===1">style="color:#c8c8c8;"</tpl>',' class="{childCls} {checkboxCls}<tpl if="checked"> {checkboxCls}-checked</tpl>"></div>',"</tpl>",'<tpl if="glyph">','<span class="{baseIconCls}" ','<tpl if="glyphFontFamily">','style="font-family:{glyphFontFamily}"',"</tpl>",">{glyph}</span>","<tpl else>",'<tpl if="icon">','<img src="{blankUrl}"',"<tpl else>","<div","</tpl>",' role="presentation" class="{childCls} {baseIconCls} {customIconCls} ','{baseIconCls}-<tpl if="leaf">leaf<tpl else><tpl if="expanded">parent-expanded<tpl else>parent</tpl></tpl> {iconCls}" ','<tpl if="icon">style="background-image:url({icon})"/><tpl else>></div></tpl>',"</tpl>",'<tpl if="href">','<a href="{href}" role="link" target="{hrefTarget}" class="{textCls} {childCls}">{value}</a>',"<tpl else>",'<span class="{textCls} {childCls}">{value}</span>',"</tpl>"]}),Ext.define("Ext.vcf.Node",{extend:"Ext.data.Record",fields:[{name:"id",type:"string"},{name:"code",type:"string"},{name:"name",type:"string"}]}),Ext.define("Ext.vcf.AssistTree.Loader",{extend:"Ext.data.TreeStore",onProxyLoad:function(e){this.callParent(arguments),this.ownerField&&this.ownerField.fireEvent("resetChecked",this.ownerField),this.ownerField.fireEvent("lastExecute",this.ownerField)}}),Ext.define("Ext.vcf.AssistTree",{extend:"Ext.tree.Panel",alias:"vcf.assisttree",xtype:"assisttree",url:"/manage/ele_chk_tree.htm",source:"",condition:"",params:{},uiProviders:{},selectModel:"single",treeRootText:"全部",checkReadOnly:!1,isCodeAsValue:!1,isDirect:!1,isPermission:!0,isFullData:!1,isFullLevel:!0,border:!0,useArrows:!0,autoScroll:!0,animate:!1,clearOnLoad:!0,checkPropagation:"both",triStateCheckbox:1,initComponent:function(){var n=this;(this.source||this.url)&&(this.store=Ext.create("Ext.vcf.AssistTree.Loader",{fields:["id","code","name","text","leaf"],root:{id:"0",text:this.treeRootText,expanded:!0,checked:"multiple"!=n.selectModel&&null},proxy:{type:"ajax",url:this.url,reader:"json"},source:this.source,condition:this.condition,isDirect:this.isDirect,uiProviders:this.uiProviders,isPermission:this.isPermission,isFullData:this.isFullData,isFullLevel:this.isFullLevel,selectModel:this.selectModel,params:this.params,ownerField:this,listeners:{beforeload:function(e,t){n.fireEvent("beforequery",e,t);var i={selectmodel:this.selectModel,source:this.source,condition:this.condition,isdirect:this.isDirect,isfulldata:this.isFullData,isfulllevel:this.isFullLevel,ispermission:this.isPermission};e.baseParams=mergeObj(i,this.params),Ext.apply(t.config.params,e.baseParams)}}})),this.callParent(arguments)},setSource:function(e){this.source=e,this.store.source=e,this.store.reload()},setParams:function(e){this.params=e,this.store.params=e,this.store.reload()},getSource:function(){return this.source},setCondition:function(e){this.condition=e,this.store.condition=e,this.store.reload()},getCondition:function(){return this.condition},treeCheckTrue:function(e){var t=this;void 0!==e?t.nodeCheckTrue(e):t.nodeCheckTrue(t.getRootNode())},nodeCheckTrue:function(e){e.eachChild(function(e){e.set("checked",!0),e.cascadeBy(function(e){e.set("checked",!0)})})},treeCheckFalse:function(){var e=this.getChecked();if(e&&e.length)for(var t=0;t<e.length;t++)e[t].set("checked",!1)},resetChecked:function(t,i){var n=this;this.getRootNode().isLoading()?this.on("resetChecked",function(e){n.setResetChecked(t,i)}):n.setResetChecked(t,i)},setResetChecked:function(e,t){var i=this;i.getRootNode().cascadeBy(function(){this.set("checked",!1),i.isExistsNode(this,e,t,i.isCodeAsValue)&&i.view.setChecked(this,!0),i.checkReadOnly})},isExistsNode:function(e,t,i,n){if("object"==typeof t){if(null!=t)if(n&&e.data.code){for(var a=e.data.code,s=0;s<t.length;s++)if("object"==typeof t[s]&&void 0!==i){if(a==t[s][i])return!0}else if(a==t[s])return!0}else for(var o=e.data.id,s=0;s<t.length;s++)if("object"==typeof t[s]&&void 0!==i){if(o==t[s][i])return!0}else if(o==t[s])return!0;return!1}if(""!=t)if(n&&e.data.code){a=","+e.data.code+",";if(-1!=(","+t+",").indexOf(a))return!0}else{var r=","+e.data.id+",";if(-1!=(","+t+",").indexOf(r))return!0}return!1},selectNodeByLikeText:function(t,i,n,e){var a=!1,s=t;this.getRootNode().cascadeBy(function(){var e=!0;return this==t?a=!0:!a||(1==i?0<=this.get("text").indexOf(n)&&(e=!1):2==i?0==this.get("text").indexOf(n)&&(e=!1):3==i?this.get("text").indexOf(n)==this.get("text").length-n.length&&(e=!1):4==i&&(this.get("text")!=n&&this.get("code")!=n&&this.get("name")!=n||(e=!1)),e||s!=t||(s=this),e)}),this.selectItemByNode(s)},selectNodeByValue:function(e){var t=this.isCodeAsValue?this.store.findNode("code",e):this.store.getNodeById(e);this.selectItemByNode(t)},selectItemByNode:function(e){var t=this;t.getSelectionModel().select(e),setTimeout(function(){t.fireEvent("itemclick",t,e)},0)},getCheckValues:function(){var t=this,e=t.getChecked();if(Ext.isEmpty(e))return"";var i="";return Ext.each(e,function(e){e.isLeaf()&&(i=t.isCodeAsValue?i+e.data.code+",":i+e.data.id+",")}),0<i.length&&(i=i.substring(0,i.length-1)),i}}),Ext.define("Ext.vcf.ComboField",{extend:"Ext.form.field.ComboBox",alias:"vcf.combofield",xtype:"combofield",queryMode:"local",valueField:"value",displayField:"text",url:"/manage/ele_chk_tree.htm",enumData:"",source:"",condition:"",editable:!1,isCodeAsValue:!1,isDirect:!1,multiStringVal:!0,validateOnBlur:!1,forceSelection:!0,triggerAction:"all",initComponent:function(){var e=this;""==e.source?void 0===e.store&&(e.store=new Ext.data.Store({fields:["value","text"],data:e.getEnumData()})):(e.queryMode="remote",e.valueField=this.isCodeAsValue?"code":"id",e.displayField="name",e.store=new Ext.data.ArrayStore({autoLoad:!0,fields:["id","code","name"],url:e.url,source:e.source,condition:e.condition,isDirect:e.isDirect,proxy:{type:"ajax",url:e.url,reader:{type:"json"}},listeners:{beforeload:function(e,t){Ext.apply(t.config.params,{source:this.source,condition:this.condition,isdirect:this.isDirect})}}})),e.multiSelect&&(e.listConfig={itemTpl:Ext.create("Ext.XTemplate","<input type=checkbox>{"+e.displayField+"}"),onItemSelect:function(e){var t,i=this.getNode(e);i&&(Ext.fly(i).addCls(this.selectedItemCls),null!=(t=i.getElementsByTagName("input"))&&(t[0].checked=!0))},listeners:{itemclick:function(e,t,i,n,a,s){var o=e.isSelected(i),r=i.getElementsByTagName("input");null!=r&&(r[0].checked=!o)}}}),e.callParent(arguments),Ext.isIE||void 0===e.hiddenId&&(e.hiddenId=e.id+"_sub")},setSource:function(e){this.source=e,"remote"==this.mode&&(this.store.source=e),this.store.reload()},getSource:function(){return this.source},getNode:function(){return""!=this.getSource()?this.getSelectedRecord():null},setCondition:function(e){this.condition=e,"remote"==this.mode&&(this.store.condition=e),this.store.reload()},getCondition:function(){return this.condition},setEnumData:function(e){this.enumData=e,this.store.loadData(this.getEnumData())},getEnumData:function(){var e=[];if(null!=this.enumData&&""!=this.enumData)if(-1!=this.enumData.indexOf("#"))for(var t=(s=this.enumData+"+").indexOf("+");-1!=t;){var i=s.substring(0,t);s=s.substring(t+1,s.length);var n=i.indexOf("#"),a={};-1!=n&&(a.value=i.substring(0,n),a.text=i.substring(n+1,i.length)),e.push(a),t=s.indexOf("+")}else for(var s,t=(s=this.enumData+",").indexOf(",");-1!=t;){i=s.substring(0,t);s=s.substring(t+1,s.length);a={value:i,text:i};e.push(a),t=s.indexOf(",")}return e},getSubmitValue:function(){var e=this.getValue();return Ext.isEmpty(e)?e="":this.multiSelect&&this.multiStringVal&&(e=e.join()),e},setValue:function(e){var t=e;return this.multiSelect&&this.multiStringVal&&null!=e&&(Ext.isArray(e)||(t=e.split(","))),Ext.vcf.ComboField.superclass.setValue.call(this,t)}}),Ext.define("Ext.vcf.TreeField",{extend:"Ext.form.field.Picker",xtype:"treefield",requires:["Ext.tree.Panel"],uses:["Ext.tree.Panel"],triggerCls:Ext.baseCSSPrefix+"form-arrow-trigger",url:"/manage/ele_chk_tree.htm",treeRootText:"全部",source:"",condition:"",rootVisible:!0,editable:!1,isCodeAsValue:!1,isDirect:!1,isPermission:!0,isRelation:void 0,isFullData:!1,isFullLevel:!0,mode:"local",triggerAction:"all",selectedClass:"",validateOnBlur:!1,selectNodeModel:"leaf",selectModel:"single",checkPropagation:"both",initComponent:function(){this.relationobj=[],this.treeId=Ext.id()+"-tree",this.callParent(arguments)},createPicker:function(){var n=this;void 0===n.store&&(n.store=Ext.create("Ext.data.TreeStore",{ownerField:n,proxy:{type:"ajax",url:n.url},root:{id:"0",text:n.treeRootText,expanded:!0},listeners:{beforeload:function(e,t){n.fireEvent("beforequery",e,t);var i={selectmodel:n.selectModel,source:n.source,condition:n.condition,isdirect:n.isDirect,ispermission:n.isPermission,isfulldata:n.isFullData,isfulllevel:n.isFullLevel,values:n.getValue()};n.isRelation&&(i.relationfilter=JSON.stringify(n.relationobj)),e.baseParams=mergeObj(i,this.params),Ext.apply(t.config.params,e.baseParams)}}}));var e=Ext.create("Ext.toolbar.Toolbar",{items:[{text:"确定",handler:function(){n.setValue(n.picker.getRootNode()),n.collapse()}},"-",{text:"取消",handler:function(){n.collapse()}},"->",{xtype:"locatefield",emptyText:"请输入模糊文本",enableKeyEvents:!0,listeners:{locate:function(e,t){n.queryTempletItem(e.getValue())}}}]}),t=n.picker;return n.picker=t=Ext.create("Ext.tree.Panel",{scrollable:!0,floating:!0,shadow:!1,store:this.store,rootVisible:this.rootVisible,checkPropagation:this.checkPropagation,triStateCheckbox:0,tbar:"multiple"==this.selectModel?e:null}),"single"==n.selectModel&&t.on({itemclick:n.onItemClick,itemkeydown:n.onPickerKeyDown,scope:this}),t},onItemClick:function(e,t,i,n,a,s){this.selectItem(t)},onPickerKeyDown:function(e,t,i,n,a){var s=a.getKey();(s===a.ENTER||s===a.TAB&&this.selectOnTab)&&this.selectItem(t)},selectItem:function(e){var t=this,i=t.selectNodeModel,n=e.isLeaf();if("0"!=e.getId()){if("folder"==i&&n)return;if("leaf"==i&&!n)return}var a=t.getNode();t.setValue(e),t.collapse(),t.fireEvent("select",t,e,a)},onExpand:function(){"multiple"==this.selectModel?this.resetChecked(this.getPicker().getRootNode(),this.getValue(),this.isCodeAsValue):void 0!==this.treePath&&this.findChildNodesById(this.getPicker().getRootNode(),this.treePath,!1)},alignPicker:function(){var e,t,i,n=this;n.rendered&&!n.destroyed&&(e=n.getPicker(),n.matchFieldWidth&&e.setWidth(n.bodyEl.getWidth()),e.setHeight(300),e.isVisible()&&e.isFloating()&&(e.el.alignTo(n.triggerWrap,n.pickerAlign,n.pickerOffset),i=e.floatParent?e.getOffsetsTo(e.floatParent.getTargetEl()):e.getXY(),e.x=i[0],e.y=i[1],t=e.el.getY()<n.inputEl.getY(),n.bodyEl[t?"addCls":"removeCls"](n.openCls+"-above"),e[t?"addCls":"removeCls"](e.baseCls+"-above")))},onTriggerClick:function(e){var t=this,i=t.store;t.readOnly||t.disabled||(t.isExpanded?t.collapse():(t.requestload&&(i&&(i.isLoading()||i.reload()),delete t.requestload),t.expand()))},resetChecked:function(e,t,i){var n=this,a=n.picker;(e=e||a.getRootNode()).cascadeBy(function(){this.set("checked",!1),n.isExistsNode(this,t,i)&&a.view.setChecked(this,!0)})},isExistsNode:function(e,t,i){if(null!=t&&""!=t)if(i&&e.get("code")){var n=","+e.get("code")+",";if(-1!=(","+t+",").indexOf(n))return!0}else{var a=","+e.get("id")+",";if(-1!=(","+t+",").indexOf(a))return!0}return!1},setSource:function(e){return this.source=e,this.reset(),this.requestload=!0,this},getSource:function(){return this.source},setCondition:function(e){return this.condition=e,this.reset(),this.requestload=!0,this},getCondition:function(){return this.condition},resetRelations:function(){this.relationobj=[]},getRelations:function(){return this.relationobj},appendRelations:function(e){return this.relationobj.push(e),this},removeRelations:function(e){return-1<e&&this.relationobj.splice(e,1),this},getNodeById:function(e){return this.store.byIdMap[e]},getNode:function(){return this.node},getNodeByCode:function(e){return this.store.findNode("code",e)},findTextById:function(e,t){},findChildNodesById:function(e,t,i){var n=this,a=n.picker;this.getPicker().expandPath(t,"id","/",function(e,t){i?a.fireEvent("itemclick",a,t):a.getSelectionModel().select(t),n.node=t})},requestTreeValue:function(s,e){var t;s.value=e,""!=s.source&&(t="/manage/eleinfo_ajax_id.htm",s.isCodeAsValue&&(t="/manage/eleinfo_ajax_code.htm"),Ext.Ajax.request({url:t,success:function(e){var t=Ext.JSON.decode(e.responseText);if(0!=t.length){var i=new Ext.vcf.Node;i.set(t),s.node=i,s.isCodeAsValue?(s.lastSelectionText=t.code+" "+t.name,s.hiddenField&&(s.hiddenField.value=t.code),Ext.form.field.Picker.superclass.setValue.call(s,t.code+" "+t.name),s.value=t.code):(s.lastSelectionText=t.code+" "+t.name,s.hiddenField&&(s.hiddenField.value=t.id),Ext.form.field.Picker.superclass.setValue.call(s,t.code+" "+t.name),s.value=t.id);var n="/0";if(t.level_num)for(var a=1;a<=t.level_num;a++)n=n+"/"+t["id"+a];s.setTreePath(n)}else s.setValue(""),s.node=null},failure:function(e){s.setValue("")},params:{source:s.source,value:e}}))},requestTreeChkValue:function(s,e){var t;s.value=e,""!=s.source&&(t="/manage/eleinfo_ajax_ids.htm",s.isCodeAsValue&&(t="/manage/eleinfo_ajax_codes.htm"),Ext.Ajax.request({url:t,success:function(e){for(var t=Ext.JSON.decode(e.responseText),i="",n="",a=0;a<t.length;a++)n=(i=s.isCodeAsValue?i+t[a].code+",":i+t[a].id+",",n+t[a].name+"/");0<i.length&&(i=i.substring(0,i.length-1),n=n.substring(0,n.length-1)),s.lastSelectionText=n,s.hiddenField&&(s.hiddenField.value=i),Ext.form.field.Picker.superclass.setValue.call(s,n),s.value=i},failure:function(e){s.setValue("")},params:{source:s.source,value:e}}))},setValue:function(e){if(void 0!==e){var t=this,i=t.value;if("multiple"==t.selectModel)if("object"==typeof e&&null!=e){var n=t.getPicker().getChecked();if(Ext.isEmpty(n))return null!=i&&i===t.value||t.fireEvent("afterchange",t,t.value,i),t;var a="",s="";Ext.each(n,function(e){e.isLeaf()&&(a=e.getOwnerTree().isCodeAsValue?a+e.get("code")+",":a+e.get("id")+",",s.length<100&&(s=s+e.get("name")+"/"))}),0<a.length&&(a=a.substring(0,a.length-1),s=100<=s.length?s.substring(0,s.length-1)+"...":s.substring(0,s.length-1)),t.lastSelectionText=s,t.hiddenField&&(t.hiddenField.value=a),Ext.form.field.Picker.superclass.setValue.call(t,s),t.value=a}else null==e||""==e?(this.lastSelectionText="",this.hiddenField&&(this.hiddenField.value=""),Ext.form.field.Picker.superclass.setValue.call(t,""),this.value=""):this.requestTreeChkValue(this,e);else try{if(t.node=void 0,"object"==typeof e?e.data?t.node=e:(e=e.id,t.picker&&(t.node=t.getNodeById(e))):""!=e&&t.picker&&(t.node=t.getNodeById(e)),null==e||""==e){if(!t.picker)return t.value="",Ext.form.field.Picker.superclass.setValue.call(this,""),delete t.node,null!=i&&i===t.value||t.fireEvent("afterchange",t,t.value,i),t;t.node=t.picker.getRootNode()}if(void 0===t.node)return"ELE"==t.source?t.value=e:t.requestTreeValue(t,e),null!=i&&i===t.value||t.fireEvent("afterchange",t,t.value,i),t;var o=t.node,r=o.get("text"),l=o.get("id");o==t.getPicker().getRootNode()?r=l="":t.isCodeAsValue&&(l=o.get("code")),t.lastSelectionText=r,t.hiddenField&&(t.hiddenField.value=l),Ext.form.field.Picker.superclass.setValue.call(this,r),t.value=l,t.setTreePath(o.getPath("id"))}catch(e){console.log(e)}return null!=i&&i===t.value||t.fireEvent("afterchange",t,t.value,i),t.value}},getValue:function(){return void 0!==this.value?this.value:""},getSubmitValue:function(){var e=this.getValue();return Ext.isEmpty(e)&&(e=""),e},setTreePath:function(e){this.treePath=e},getTreePath:function(){return this.treePath},clearValue:function(){this.value=null,this.node=null},queryTempletItem:function(t){var e=this.picker,i=e.getSelectionModel(),n=null;null!=i&&(n=i.selected.items[0]),null==n&&(n=e.getRootNode());var a=!1,s=n;e.getRootNode().cascadeBy(function(){var e=!0;return this==n?a=!0:!a||(0<=this.get("text").indexOf(t)&&(e=!1),e||s!=n||(s=this),e)}),this.findChildNodesById(e.root,s.getPath(),!1)}}),Ext.define("Ext.vcf.CheckboxField",{extend:"Ext.form.field.Checkbox",xtype:"chkfield",trueValue:"1",falseValue:"0",initComponent:function(){this.inputValue=this.trueValue,this.uncheckedValue=this.falseValue,this.callParent(arguments)}}),Ext.define("Ext.vcf.ChkGroup",{extend:"Ext.form.CheckboxGroup",xtype:"chkgroup",delimiter:",",enumData:"",initComponent:function(){this.items=this.getEnumData(),this.callParent(arguments)},getEnumData:function(){var e=[];if(null!=this.enumData&&""!=this.enumData)for(var t=(n=this.enumData+"+").indexOf("+");-1!=t;){var i=n.substring(0,t),n=n.substring(t+1,n.length),a=i.indexOf("#"),s={name:this.name};-1!=a?(s.inputValue=i.substring(0,a),s.boxLabel=i.substring(a+1,i.length)):(s.inputValue=i,s.boxLabel=""),s.inputValue==this.value&&(s.checked=!0),e.push(s),t=n.indexOf("+")}return e}}),Ext.define("Ext.vcf.RadioField",{extend:"Ext.form.RadioGroup",xtype:"rdofield",enumData:"",simpleValue:!0,initComponent:function(){this.items=this.getEnumData(),this.callParent(arguments)},setValue:function(e){var t,i,n,a,s,o,r,l=this.items;if(Ext.suspendLayouts(),this.simpleValue){for(s=0,o=l.length;s<o;++s)if((i=l.items[s]).inputValue==e){i.setValue(!0);break}}else if(Ext.isObject(e))for(r in n=(i=l.first())?i.getFormId():null,e)for(t=e[r],o=(a=Ext.form.RadioManager.getWithValue(r,t,n).items).length,s=0;s<o;++s)a[s].setValue(!0);return Ext.resumeLayouts(!0),this},getEnumData:function(){var e=[];if(null!=this.enumData&&""!=this.enumData)for(var t=(n=this.enumData+"+").indexOf("+");-1!=t;){var i=n.substring(0,t),n=n.substring(t+1,n.length),a=i.indexOf("#"),s={name:this.name};-1!=a?(s.inputValue=i.substring(0,a),s.boxLabel=i.substring(a+1,i.length)):(s.inputValue=i,s.boxLabel=""),s.inputValue==this.value&&(s.checked=!0),e.push(s),t=n.indexOf("+")}return e}}),Ext.define("Ext.vcf.FormPanel",{extend:"Ext.form.Panel",xtype:"inputpanel",layout:"column",userDefined:!1,fieldDefaults:{labelAlign:"left",labelWidth:80,msgTarget:"side"},initComponent:function(){this.callParent(arguments),this.ajaxLoaded=!1,this.userDefined?this.initUI():this.ajaxLoaded=!0},isAjaxLoaded:function(){return this.ajaxLoaded},getDictionaryValues:function(){for(var e=this.form.getFields(),t={},i=0;i<e.getCount();i++){var n,a,s=e.get(i);s.source&&""!=s.source?(n=s.source.toLowerCase(),(a=s.getNode())?(t[n+"_id"]=a.get("id"),t[n+"_code"]=a.get("code"),t[n+"_name"]=a.get("name")):(t[n+"_id"]="",t[n+"_code"]="",t[n+"_name"]="")):t[s.getName()]=s.getSubmitValue()}return t}}),Ext.define("Ext.vcf.QueryPanel",{extend:"Ext.vcf.FormPanel",xtype:"querypanel",contain_state:!1,initComponent:function(){this.callParent()},getQuery:function(){for(var e=this.form.getFields(),t=[],i=0;i<e.getCount();i++){var n,a=e.get(i);!this.contain_state&&"state"==a.getName()||(n={field:a.getName(),op:a.logic||"=",data:a.getSubmitValue(),type:a.data_type||"string"},t.push(n))}return t},getQueryString:function(){return Ext.encode(this.getQuery())},getState:function(){var e=this.form.findField("state");return e?e.getSubmitValue():""},getQueryParams:function(){return this.contain_state?{querystr:this.getQueryString()}:{querystr:this.getQueryString(),state:this.getState()}}}),Ext.define("Ext.vcf.ColumnModel",{extend:"Ext.grid.ColumnModel",xtype:"clmodel",setEnumData:function(e,t){this.config[e].enumData=t},getEnumData:function(e){return this.config[e].enumData?this.config[e].enumData:""}}),Ext.define("Ext.vcf.TableGrid",{extend:"Ext.grid.Panel",xtype:"tablegrid",isChecked:!1,checkOnly:!1,isPaged:!0,url:"",params:{},pageSize:50,userDefined:!1,autoLoad:!0,scrollable:!0,region:"center",margins:"3 3 3 3",implicitIncludes:!0,loadMask:{msg:"正在加载表格数据,请稍等..."},columnLines:!0,stripeRows:!0,frame:!0,constructor:function(e){this.callParent([e])},initComponent:function(){var e,t,i,n,a=this,s=a.columnBase||[];a.fieldBase=a.fieldBase||[],void 0===a.columns&&(0==s.length&&(s.push({xtype:"rownumberer",width:40}),a.isChecked&&(e=Ext.create("Ext.selection.CheckboxModel",{checkOnly:this.checkOnly,injectCheckbox:1}),a.selModel=e)),a.columns=a.columnBase=s),void 0===a.store&&(t=a.model||Ext.create("Ext.data.Model",{fields:a.fieldBase,validators:a.validators,idProperty:a.keyDataIndex||"id"}),a.store=Ext.create("Ext.data.Store",{model:t,proxy:{type:"ajax",url:a.url,actionMethods:{read:"POST"},reader:{type:"json",totalProperty:"total",rootProperty:"data",implicitIncludes:a.implicitIncludes}}})),a.isPaged&&((i=Ext.create("Ext.form.field.ComboBox",{name:"pagesize",triggerAction:"all",lazyRender:!0,mode:"local",store:new Ext.data.ArrayStore({fields:["value","text"],data:[[10,"10条/页"],[20,"20条/页"],[50,"50条/页"],[100,"100条/页"],[250,"250条/页"],[500,"500条/页"],[5e3,"5000条/页"]]}),valueField:"value",displayField:"text",value:a.pageSize,editable:!1,width:100})).on("select",function(e){var t=parseInt(e.getValue());a.store.setPageSize(t),a.store.currentPage=1,n.doRefresh()}),a.store.pageSize=a.pageSize,n=Ext.create("Ext.toolbar.Paging",{displayInfo:!0,plugins:"ux-progressbarpager",emptyMsg:"没有符合条件的记录",items:["-","&nbsp;&nbsp;",i]}),a.bbar=n),a.ajaxLoaded=!1,a.callParent(arguments),a.userDefined?(a.initUI(),a.autoQuery=a.autoLoad,a.autoLoad=!1):(a.autoLoad&&a.store.load({params:a.params}),a.ajaxLoaded=!0)},isAjaxLoaded:function(){return this.ajaxLoaded},queryData:function(e){this.params=e,Ext.apply(this.store.proxy.extraParams,this.params),this.store.load(this.params)},requeryData:function(e){mergeObj(this.params,e),Ext.apply(this.store.proxy.extraParams,this.params),this.store.reload()},requery:function(e){this.requeryData(e)}}),Ext.define("Ext.vcf.chkCellSelModel",{extend:"Ext.selection.CheckboxModel",contain_field:"",constructor:function(){this.callParent(arguments),this.contains=new Ext.util.MixedCollection(!1,function(e){return e.id})},initEvents:function(){Ext.vcf.ChkCellSelModel.superclass.initEvents.call(this),this.grid.on("render",function(){var e=this.grid.getView();e.mainBody.on("mousedown",this.onMouseDown,this),Ext.fly(e.innerHd).on("mousedown",this.onHdMouseDown,this)},this)},onRefresh:function(){var e,t=this.grid.store,i=this.getContains();this.clearContains(!0);for(var n=0,a=i.length;n<a;n++){var s=i[n];-1!=(e=t.indexOfId(s.id))&&this.containRow(e,!0)}},onViewChange:function(){this.clearSelections(!0),this.clearContains(!0)},getCount:function(){return this.contains.length},onMouseDown:function(e,t){var i,n,a;0===e.button&&"x-grid3-row-checker"==t.className&&(e.stopEvent(),(i=e.getTarget(".x-grid3-row"))&&(n=function(e,t,i){""!=e.contain_field&&e.grid.store.getAt(i).set(e.contain_field,t)},a=i.rowIndex,this.isContained(a)?(n(this,0,a),this.decontainRow(a,!1)):(n(this,1,a),this.containRow(a,!0,!1))))},onHdMouseDown:function(e,t){var i,n;"x-grid3-hd-checker"==t.className&&(e.stopEvent(),n=function(e,t){if(""!=e.contain_field)for(var i=0;i<e.grid.store.getCount();i++){e.grid.store.getAt(i).set(e.contain_field,t)}},(i=Ext.fly(t.parentNode)).hasClass("x-grid3-hd-checker-on")?(i.removeClass("x-grid3-hd-checker-on"),n(this,0),this.clearContains()):(i.addClass("x-grid3-hd-checker-on"),n(this,1),this.containAll()))},isContained:function(e){var t=Ext.isNumber(e)?this.grid.store.getAt(e):e;return!(!t||!this.contains.key(t.id))},containRow:function(e,t,i){var n;this.isLocked()||e<0||e>=this.grid.store.getCount()||t&&this.isContained(e)||(n=this.grid.store.getAt(e))&&(t||this.clearContains(),this.contains.add(n),this.last=this.lastActive=e,i||this.grid.getView().onRowSelect(e))},decontainRow:function(e,t){var i;this.isLocked()||(this.last==e&&(this.last=!1),this.lastActive==e&&(this.lastActive=!1),(i=this.grid.store.getAt(e))&&(this.contains.remove(i),t||this.grid.getView().onRowDeselect(e)))},getContains:function(){return[].concat(this.contains.items)},getContained:function(){return this.contains.itemAt(0)},each:function(e,t){for(var i=this.getContains(),n=0,a=i.length;n<a;n++)if(!1===e.call(t||this,i[n],n))return!1;return!0},clearContains:function(e){var t,i;this.isLocked()||(!0!==e?(t=this.grid.store,(i=this.contains).each(function(e){this.decontainRow(t.indexOfId(e.id))},this),i.clear()):this.contains.clear(),this.last=!1)},containAll:function(){this.contains.clear();for(var e=0,t=this.grid.store.getCount();e<t;e++)this.containRow(e,!0)},renderer:function(e,t,i){return'<div class="x-grid3-row-checker">&#160;</div>'}}),Ext.define("Ext.vcf.EditorColumnModel",{extend:"Ext.grid.header.Container",constructor:function(e,t,i){var n=this,a=i||[];if(n.grid=e,n.store=t,Ext.isArray(a)&&(a={items:a}),a.items)for(var s,o=a.items,r=0,l=o.length;r<l;r++)!(s=o[r]).isGroupHeader&&s.editable&&(s.getEditor=n.getCellEditor.bind(n,s));a.isRootHeader=!0,n.callParent([a])},getCellEditor:function(e,t){return this.grid.getCellEditor(t,e)}}),Ext.define("Ext.vcf.EditorTableGrid",{extend:"Ext.vcf.TableGrid",xtype:"editortablegrid",isChecked:!1,checkOnly:!1,isPaged:!0,isRowEditor:!1,keyDataIndex:void 0,editDataIndex:"",url:"",params:{},pageSize:50,userDefined:!1,clicksToEdit:1,autoScroll:!0,region:"center",margins:"3 3 3 3",implicitIncludes:!1,loadMask:{msg:"正在加载表格数据,请稍等..."},stripeRows:!0,frame:!0,initComponent:function(){var e,t=this,i=t.columnBase||[];t.fieldBase=t.fieldBase||[],t.editing=Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:t.clicksToEdit}),t.plugins=t.plugins||[],t.plugins.push(t.editing),void 0===t.columns&&(0==i.length&&(i.push({xtype:"rownumberer"}),t.isChecked&&(e=Ext.create("Ext.selection.CheckboxModel",{checkOnly:this.checkOnly}),t.selModel=e)),t.isRowEditor?(t.editors={string:new Ext.grid.CellEditor({field:new Ext.form.field.Text({selectOnFocus:!0,allowBlank:!1})}),object:new Ext.grid.CellEditor({field:new Ext.form.field.Text({selectOnFocus:!0,allowBlank:!1})}),combox:new Ext.grid.CellEditor({field:new Ext.vcf.ComboField({selectOnFocus:!0,allowBlank:!1})}),tree:new Ext.grid.CellEditor({field:new Ext.vcf.TreeField({selectOnFocus:!0,allowBlank:!1})}),date:new Ext.grid.CellEditor({field:new Ext.form.field.Date({selectOnFocus:!0,allowBlank:!1})}),number:new Ext.grid.CellEditor({field:new Ext.form.field.Number({selectOnFocus:!0,allowBlank:!1,style:"text-align:left;"})}),boolean:new Ext.grid.CellEditor({field:new Ext.form.field.ComboBox({editable:!1,store:[[!0,"是"],[!1,"否"]]})})},t.columnBase=i,t.columns=new Ext.vcf.EditorColumnModel(t,t.store,t.columnBase)):t.columns=t.columnBase=i),t.callParent(arguments),t.userDefined?t.initUI():t.store.load(t.params)},getCellEditor:function(e,t){var i=e,n=Ext.isEmpty(this.editDataIndex)?1:i.data[this.editDataIndex],a=e.data[t.dataIndex];if(1==n||1==n)return Ext.isDate(a)?this.editors.date:"number"==typeof a?this.editors.number:"boolean"==typeof a?this.editors.boolean:"object"==typeof a?this.editors.object:this.editors.string}}),Ext.define("Ext.vcf.CustomNumberField",{xtype:"custnumberfield",requires:[],alias:"widget.CustNumberField",extend:"Ext.form.field.Text",alternateClassName:"Ext.vcf.CustomNumberField",fieldLabel:"",fieldStyle:{"text-align":"right"},minValue:Number.NEGATIVE_INFINITY,maxValue:Number.MAX_VALUE,minText:"数字最小为 {0}",maxText:"数字最大为 {0}",nanText:"{0} 不是一个有效数字",prefixChar:"",suffixChar:"",numberFormatter:"",numberColored:!0,allowDecimals:!1,allowNegative:!0,baseChars:"0123456789",decimalSeparator:".",decimalPrecision:2,value:0,_displayVal:0,_submitVal:0,listeners:{focus:function(e,t,i){this.editable&&(this.value=this._submitVal,this.setRawValue(this.value),this.focus(!0,100))}},initComponent:function(){this.setValue(this.value),this.callParent(arguments)},setValue:function(e){e=(e=this.parseValue(e))||0,this._submitVal=this.fixPrecision(e),""!=this.numberFormatter?this._displayVal=this.prefixChar+" "+Ext.util.Format.number(this._submitVal,this.numberFormatter)+this.suffixChar:this._displayVal=this.prefixChar+" "+this._submitVal+this.suffixChar,e=this._displayVal,this.callParent(arguments),this.numberColored&&(0<=this._submitVal?this.setFieldStyle({"text-align":"right",color:"BLACK"}):this.setFieldStyle({"text-align":"right",color:"RED"}))},beforeBlur:function(){var e=this.parseValue(this.getRawValue());this.setValue(e)},validateValue:function(e){if((e=""==this._submitVal?0:this._submitVal).length<1)return!0;if(e=String(e).replace(this.decimalSeparator,"."),isNaN(e))return this.markInvalid(String.format(this.nanText,e)),!1;var t=this.parseValue(e);return t<this.minValue?(this.markInvalid(String.format(this.minText,this.minValue)),!1):!(t>this.maxValue)||(this.markInvalid(String.format(this.maxText,this.maxValue)),!1)},parseValue:function(e){return e=parseFloat(String(e).replace(this.decimalSeparator,".")),isNaN(e)?"":e},fixPrecision:function(e){var t=isNaN(e);return this.allowDecimals&&-1!=this.decimalPrecision&&!t&&e?parseFloat(parseFloat(e).toFixed(this.decimalPrecision)):t?"":e},initEvents:function(){var e=this.baseChars+"",n=this.baseChars+"";""!=this.prefixChar&&(e+=this.prefixChar),""!=this.suffixChar&&(e+=this.suffixChar),""!=this.numberFormatter&&(e+=",:"),this.allowDecimals&&(e+=this.decimalSeparator,n+=this.decimalSeparator),this.allowNegative&&(e+="-",n+="-"),this.stripCharsRe=new RegExp("[^"+e+"]","gi");this.el.on("keypress",function(e){var t,i=e.getKey();(Ext.isIE||!e.isSpecialKey()&&i!=e.BACKSPACE&&i!=e.DELETE)&&(t=e.getCharCode(),-1===n.indexOf(String.fromCharCode(t))&&e.stopEvent())},this),this.callParent(arguments)},constructor:function(e){this.callParent(arguments)},getSubmitValue:function(){return 0==this._submitVal?0:this._submitVal}}),Ext.define("Ext.vcf.MoneyField",{extend:"Ext.vcf.CustomNumberField",xtype:"moneyfield",currencyChar:"¥",moneyFormatter:"0,000.00",allowDecimals:!0,minText:"金额最小为 {0}",maxText:"金额最大为 {0}",nanText:"{0} 不是一个有效金额",initComponent:function(){Ext.apply(this,{prefixChar:this.currencyChar,suffixChar:"",numberFormatter:this.moneyFormatter}),this.callParent(arguments)}}),Ext.define("Ext.vcf.PercentField",{extend:"Ext.vcf.CustomNumberField",xtype:"percentfield",allowDecimals:!0,allowNegative:!1,percentChar:"%",initComponent:function(){Ext.apply(this,{prefixChar:"",suffixChar:this.percentChar}),this.callParent(arguments)}}),Ext.define("Ext.vcf.LocateField",{extend:"Ext.form.field.Text",xtype:"locatefield",triggers:{clear:{weight:0,cls:Ext.baseCSSPrefix+"form-clear-trigger",hidden:!0,handler:"onClearClick",scope:"this"},search:{weight:1,cls:Ext.baseCSSPrefix+"form-search-trigger",handler:"onSearchClick",scope:"this"}},hasSearch:!1,paramName:"query",initComponent:function(){var i=this;i.callParent(arguments),i.on("specialkey",function(e,t){t.getKey()==t.ENTER&&i.onSearchClick()})},onClearClick:function(){this.setValue(""),this.getTrigger("clear").hide(),this.updateLayout()},onSearchClick:function(){var e=this,t=e.getValue();e.fireEvent("locate",e,t),e.getTrigger("clear").show(),e.updateLayout()}}),Ext.define("Ext.vcf.IconField",{extend:"Ext.form.field.ComboBox",alias:"vcf.iconfield",xtype:"iconfield",validateOnBlur:!1,forceSelection:!0,triggerAction:"all",initComponent:function(){Ext.apply(this,{store:new Ext.data.ArrayStore({autoLoad:!0,fields:["icons"],proxy:{type:"ajax",url:"/manage/icons_list.htm",reader:{type:"json"}}}),queryMode:"local",displayField:"icons",valueField:"icons",iconClsField:"icons",tpl:Ext.create("Ext.XTemplate",'<table><tr><tpl for="."><td class="x-boundlist-item :qtip={icons}" ><img width=16 height=16 style="vertical-align: middle;" class="{icons}" /><span>{icons}</span></td><tpl if="xindex % 2 === 0"></tr><tr></tpl></tpl></tr></table>'),displayTpl:Ext.create("Ext.XTemplate",'<tpl for=".">',"{icons}","</tpl>")}),this.callParent(arguments)},onRender:function(e,t){var i=this;i.callParent(arguments),i.inputWrap.applyStyles({position:"relative"}),i.inputEl.addCls("ux-icon-combo-input"),i.icon=Ext.core.DomHelper.append(i.inputEl.up("div.x-form-text-wrap"),{tag:"div",style:"position:absolute"})},onBeforeSelect:function(e,t,i){this.setIconCls(t.get("icons"))},setIconCls:function(e){this.icon&&(this.icon.className="ux-icon-combo-icon "+e)},setValue:function(e){this.callParent(arguments),this.setIconCls(e)}}),Ext.override(Ext.container.Viewport,{loadOnShow:!1,initComponent:function(){var e=this;e.callParent(arguments),e.ajaxLoaded=!1,e.toolLoaded=!1,e.toolLoading(),e.loadOnShow&&e.triggerLoading()},triggerLoading:function(){var n,a,s;this.ajaxLoaded||(a=(n=this).query("inputpanel, tablegrid"),s=setInterval(function(){for(var e=!0,t=0,i=a.length;t<i;t++)if(a[t].isAjaxLoaded&&!a[t].isAjaxLoaded()){e=!1;break}e&&(n.ajaxLoaded=!0,clearInterval(s),n.hasListeners.afterloadui&&n.fireEvent("afterloadui",n))},100))},toolLoading:function(){if(!this.toolLoaded){var e,t,i=this.query("form,grid");if(this.toolLoaded=!0,"undefined"!=typeof main_action){if(0==main_action.toolbarIndex)e=this.child("panel");else for(var n=0;n<i.length;n++)n+1==main_action.toolbarIndex&&(e=i[n]);e&&(t=e.getDockedItems('toolbar[dock="top"]'),Ext.isEmpty(main_action.toolbar)||(Ext.isEmpty(t)?e.addDocked([{xtype:"toolbar",dock:"top",items:main_action.toolbar}]):t[0].add(main_action.toolbar)))}}}}),Ext.define("Ext.vcf.Window",{extend:"Ext.window.Window",layout:"fit",width:400,autoHeight:!0,resizable:!0,draggable:!0,closable:!0,modal:!0,closeAction:"hide",collapsible:!0,titleCollapse:!0,maximizable:!0,buttonAlign:"right",border:!1,animCollapse:!0,pageY:20,loadOnShow:!1,constrain:!0,constructor:function(){Ext.vcf.Window.superclass.constructor.apply(this,arguments),Ext.isIE8||(this.pageX=document.body.clientWidth/2-(this.width+20)/2,20<this.height&&(this.pageY=.4*(document.body.clientHeight-this.height)))},initComponent:function(){this.callParent(arguments),this.ajaxLoaded=!1},triggerLoading:function(){var n,a,s;this.ajaxLoaded||(a=(n=this).query("inputpanel, tablegrid"),s=setInterval(function(){for(var e=!0,t=0,i=a.length;t<i;t++)if(a[t].isAjaxLoaded&&!a[t].isAjaxLoaded()){e=!1;break}e&&(n.ajaxLoaded=!0,clearInterval(s),n.hasListeners.afterloadui&&n.fireEvent("afterloadui",n))},100))},onShow:function(){this.callParent(arguments),this.loadOnShow&&this.triggerLoading()}});